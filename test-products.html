<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Test Product Filtering</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
      rel="stylesheet" />
    <style>
      .item_product_main {
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
      }
      .category-filter.active {
        background-color: #ff8c00;
        color: white !important;
      }
      .loading-spinner {
        text-align: center;
        padding: 50px;
      }
    </style>
  </head>
  <body>
    <div class="container mt-4">
      <h1>Test Product Filtering</h1>

      <!-- Category Filters -->
      <div class="sidebar mb-4">
        <h5>Danh mục</h5>
        <div class="nav-category">
          <ul class="list-unstyled">
            <li>
              <a
                href="#"
                class="btn btn-outline-primary d-block mb-2 category-filter"
                data-category="all"
                >Tất cả sản phẩm</a
              >
            </li>
            <li>
              <a
                href="#"
                class="btn btn-outline-primary d-block mb-2 category-filter"
                data-category="Chương trình học"
                >Chương trình học</a
              >
            </li>
            <li>
              <a
                href="#"
                class="btn btn-outline-primary d-block mb-2 category-filter"
                data-category="Chương trình học nổi bật"
                >Chương trình học nổi bật</a
              >
            </li>
            <li>
              <a
                href="#"
                class="btn btn-outline-primary d-block mb-2 category-filter"
                data-category="Chương trình học khuyến mãi"
                >Chương trình học khuyến mãi</a
              >
            </li>
            <li>
              <a
                href="#"
                class="btn btn-outline-primary d-block mb-2 category-filter"
                data-category="Chương trình học mới"
                >Chương trình học mới</a
              >
            </li>
          </ul>
        </div>
      </div>

      <!-- Products Container -->
      <div class="products-section">
        <h5>Sản phẩm</h5>
        <div class="row" id="products-container">
          <div class="col-12 text-center">
            <div class="loading-spinner">
              <i class="fa fa-spinner fa-spin"></i> Đang tải sản phẩm...
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>
    <script src="./assets/js/products.js"></script>

    <script>
      $(document).ready(function () {
        console.log("Test page loaded");

        function waitForProductManager() {
          if (
            window.productManager &&
            window.productManager.products &&
            window.productManager.products.length > 0
          ) {
            console.log("ProductManager ready! Setting up filters...");
            setupFiltering();
          } else {
            console.log("Waiting for ProductManager...");
            setTimeout(waitForProductManager, 200);
          }
        }

        function setupFiltering() {
          // Category filtering
          $(".category-filter")
            .off("click")
            .on("click", function (e) {
              e.preventDefault();
              e.stopPropagation();

              var category = $(this).data("category");
              console.log("=== FILTER TEST ===");
              console.log("Clicked category:", category);

              if (window.productManager) {
                // Call the filter function
                if (category === "all") {
                  window.productManager.filterByCategory("Sản phẩm");
                } else {
                  window.productManager.filterByCategory(category);
                }

                // Update active state
                $(".category-filter").removeClass("active");
                $(this).addClass("active");

                console.log("Filter applied!");
              } else {
                console.error("ProductManager not available!");
              }
            });

          // Initialize with all products
          console.log("Initializing with all products");
          if (window.productManager) {
            window.productManager.filterByCategory("Sản phẩm");
            $(".category-filter").first().addClass("active");
          }
        }

        waitForProductManager();
      });
    </script>
  </body>
</html>
